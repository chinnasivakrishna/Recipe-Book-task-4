<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Recipes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }

        h1 {
            text-align: center;
            margin-top: 20px;
        }

        #recipeList {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .recipe-item {
            margin-bottom: 20px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 20px;
        }

        .recipe-item h3 {
            margin-top: 0;
            color: #333;
        }

        .recipe-item img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .recipe-item strong {
            font-weight: bold;
        }

        .recipe-item input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .recipe-item button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }

        .recipe-item button:hover {
            background-color: #0056b3;
        }

    </style>
</head>
<body>
    <h1>User Recipes</h1>

    <div id="recipeList">
        <!-- Recipes will be displayed here -->
    </div>

    <script>
        // Retrieve the logged-in user's email from sessionStorage
        var email = sessionStorage.getItem("email");

        if (email) {
            // Retrieve the user's recipes from localStorage
            var userRecipes = JSON.parse(localStorage.getItem(email + '_recipes')) || [];

            // Display the user's recipes
            var recipeList = document.getElementById("recipeList");

            if (userRecipes.length > 0) {
                userRecipes.forEach(function(recipe, index) {
                    var recipeDiv = document.createElement("div");
                    recipeDiv.classList.add("recipe-item");

                    recipeDiv.innerHTML = "<h3>" + recipe.name + "</h3>" +
                        "<img src='" + recipe.image + "' alt='" + recipe.name + "'><br>" +
                        "<strong>Category:</strong> <span class='category'>" + recipe.category + "</span><br>" +
                        "<strong>Ingredients:</strong> <span class='ingredients'>" + recipe.ingredients + "</span><br>" +
                        "<strong>Method:</strong> <span class='method'>" + recipe.method + "</span><br>" +
                        "<strong>Image URL:</strong> <span class='image-url'>" + recipe.image + "</span><br>" + // Include image URL
                        "<button class='edit-button' data-id='" + index + "'>Edit</button>" +
                        "<button class='delete-button' data-id='" + index + "'>Delete</button><br><br>";

                    recipeList.appendChild(recipeDiv);
                });

                // Handle editing recipe functionality
                var editButtons = document.querySelectorAll(".edit-button");
                editButtons.forEach(button => {
                    button.addEventListener("click", function() {
                        var recipeId = parseInt(this.getAttribute("data-id"));
                        console.log(recipeId)
                        var recipeDiv = this.parentElement;

                        // Enable editing of the recipe details in-place
                        var categoryElement = recipeDiv.querySelector(".category");
                        var ingredientsElement = recipeDiv.querySelector(".ingredients");
                        var methodElement = recipeDiv.querySelector(".method");
                        var imageUrlElement = recipeDiv.querySelector(".image-url");

                        if (categoryElement && ingredientsElement && methodElement && imageUrlElement) {
                            categoryElement.innerHTML = "<input type='text' value='" + categoryElement.textContent + "'>";
                            ingredientsElement.innerHTML = "<input type='text' value='" + ingredientsElement.textContent + "'>";
                            methodElement.innerHTML = "<input type='text' value='" + methodElement.textContent + "'>";
                            imageUrlElement.innerHTML = "<input type='text' value='" + imageUrlElement.textContent + "'>";

                            // Show a save button to save the changes
                            var saveButton = document.createElement("button");
                            saveButton.textContent = "Save";
                            saveButton.addEventListener("click", function() {
                                // Update the recipe details in localStorage
                                var categoryValue = categoryElement.querySelector("input").value;
                                var ingredientsValue = ingredientsElement.querySelector("input").value;
                                var methodValue = methodElement.querySelector("input").value;
                                var imageUrlValue = imageUrlElement.querySelector("input").value;

                                // Update the recipe details in the userRecipes array
                                userRecipes[recipeId].category = categoryValue;
                                userRecipes[recipeId].ingredients = ingredientsValue;
                                userRecipes[recipeId].method = methodValue;
                                userRecipes[recipeId].image = imageUrlValue;

                                // Save the updated recipe details to localStorage
                                localStorage.setItem(email + '_recipes', JSON.stringify(userRecipes));

                                // Refresh the page to reflect the changes
                                location.reload();
                            });

                            recipeDiv.appendChild(saveButton);
                        } else {
                            console.error("One or more elements not found for recipe ID: " + recipeId);
                        }
                    });
                });

                // Handle deleting recipe functionality
                // Handle deleting recipe functionality
var deleteButtons = document.querySelectorAll(".delete-button");
deleteButtons.forEach(button => {
    button.addEventListener("click", function() {
        var recipeId = parseInt(this.getAttribute("data-id"));
        
        // Remove the recipe from the userRecipes array
        userRecipes.splice(recipeId, 1);

        // Update localStorage
        localStorage.setItem(email + '_recipes', JSON.stringify(userRecipes));

        // Remove the recipe div from the UI
        this.parentElement.remove();
    });
});

            } else {
                recipeList.innerHTML = "<p>No recipes found.</p>";
            }
        } else {
            alert("Please log in to view your recipes!");
            // Redirect to login page or handle accordingly
        }
    </script>
</body>
</html>
