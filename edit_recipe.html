<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Recipe</title>
</head>
<body>
    <h1>Edit Recipe</h1>

    <form id="edit-recipe-form">
        <label for="recipe-name">Name:</label>
        <input type="text" id="recipe-name" required>
        <br />

        <label for="recipe-image">Image URL:</label>
        <input type="text" id="recipe-image" required>
        <br />
        <label for="category-select">Category:</label>
        <select id="category-select" required>
            <!-- Placeholder for category options -->
            <option value="Breakfast">Breakfast</option>
            <option value="Lunch">Lunch</option>
            <option value="Dinner">Dinner</option>
            <option value="Dessert">Dessert</option>
            <option value="Snack">Snack</option>
        </select>
        <br />
        <label for="recipe-ingredients">Ingredients:</label>
        <textarea id="recipe-ingredients" rows="5" required></textarea>
        <br />

        <label for="recipe-method">Method:</label>
        <textarea id="recipe-method" rows="5" required></textarea>
        <br />

        <button type="submit">Save</button>
    </form>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Retrieve recipeId from the URL query string
            var urlParams = new URLSearchParams(window.location.search);
            var recipeId = parseInt(urlParams.get("recipeId"));
    
            // Retrieve the recipe from local storage based on recipeId
            var email = sessionStorage.getItem("email");
            var userRecipes = JSON.parse(localStorage.getItem(email)) || [];
            var recipeToEdit = userRecipes.find(recipe => recipe.id === recipeId);
    
            // Populate the form fields with existing recipe details or set placeholders
            if (recipeToEdit) {
                document.getElementById("recipe-name").value = recipeToEdit.name;
                document.getElementById("recipe-image").value = recipeToEdit.image;
                document.getElementById("category-select").value = recipeToEdit.category;
                document.getElementById("recipe-ingredients").value = recipeToEdit.ingredients.join("\n");
                document.getElementById("recipe-method").value = recipeToEdit.method;
            }
    
            // Handle form submission to save edited recipe
            document.getElementById("edit-recipe-form").addEventListener("submit", function(event) {
                event.preventDefault();
    
                // Update recipe details with edited values
                var name = document.getElementById("recipe-name").value.trim();
                var image = document.getElementById("recipe-image").value.trim();
                var category = document.getElementById("category-select").value.trim();
                var ingredients = document.getElementById("recipe-ingredients").value.trim().split("\n");
                var method = document.getElementById("recipe-method").value.trim();
    
                // Update the recipe in user's recipes in localStorage
                if (recipeToEdit) {
                    recipeToEdit.name = name;
                    recipeToEdit.image = image;
                    recipeToEdit.category = category;
                    recipeToEdit.ingredients = ingredients;
                    recipeToEdit.method = method;
    
                    localStorage.setItem(email, JSON.stringify(userRecipes));
                }
    
                alert("Recipe updated successfully!");
                // Redirect to user recipes page
                window.location.href = "user_recipes.html";
            });
        });
    </script>
    
</body>
</html>
